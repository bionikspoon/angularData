"use strict";angular.module("angularDataApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","firebase"]).run(["$rootScope","$location",function(a,b){a.$on("$routeChangeError",function(a,c,d,e){"AUTH_REQUIRED"===e&&b.path("/login")})}]).config(["$routeProvider",function(a){a.when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl",resolve:{currentAuth:["Authentication",function(a){return a.authObj.$waitForAuth()}]}}).when("/register",{templateUrl:"views/register.html",controller:"RegisterCtrl",resolve:{currentAuth:["Authentication",function(a){return a.authObj.$waitForAuth()}]}}).when("/meetings",{templateUrl:"views/meetings.html",controller:"MeetingsCtrl",resolve:{currentAuth:["Authentication",function(a){return a.authObj.$requireAuth()}]}}).when("/checkins/:userId/:meetingId",{templateUrl:"views/checkins.html",controller:"CheckinsCtrl",resolve:{currentAuth:["Authentication",function(a){return a.authObj.$requireAuth()}]}}).when("/checkins/:userId/:meetingId/checkinslist",{templateUrl:"views/checkinslist.html",controller:"CheckinsListCtrl",resolve:{currentAuth:["Authentication",function(a){return a.authObj.$requireAuth()}]}}).otherwise({redirectTo:"/meetings"})}]),angular.module("angularDataApp").controller("LoginCtrl",["$scope","$location","Authentication","currentAuth",function(a,b,c,d){d?b.path("/meetings"):a.login=function(){c.login(a.user).then(function(){b.path("/meetings")},function(b){a.message=b.toString()})}}]),angular.module("angularDataApp").controller("RegisterCtrl",["$scope","$location","Authentication","currentAuth",function(a,b,c,d){d?b.path("/meetings"):a.register=function(){c.register(a.user).then(function(){c.login(a.user),b.path("/meetings")})["catch"](function(b){a.message=b.toString(),console.error("Registration failed:",b)})}}]),angular.module("angularDataApp").controller("MeetingsCtrl",["$scope","$rootScope","$firebaseArray","FIREBASE","currentAuth",function(a,b,c,d,e){var f=d.child("/users/"+e.uid+"/meetings");a.meetings=c(f),a.meetings.$watch(function(){b.howManyMeetings=a.meetings.length}),a.addMeeting=function(){a.meetings.$add({name:a.meetingName,date:Firebase.ServerValue.TIMESTAMP}).then(function(){a.meetingName=""})},a.deleteMeeting=function(b){a.meetings.$remove(b)}}]),angular.module("angularDataApp").factory("Authentication",["$rootScope","$firebaseAuth","$firebaseObject","FIREBASE",function(a,b,c,d){var e=b(d),f=function(a){var b=d.child("/users/"+a);return c(b)},g={login:function(a){return e.$authWithPassword({email:a.email,password:a.password})},logout:function(){return e.$unauth()},register:function(a){return e.$createUser({email:a.email,password:a.password}).then(function(b){var c=f(b.uid);c.date=Firebase.ServerValue.TIMESTAMP,c.registeredUser=b.uid,c.firstName=a.firstName,c.lastName=a.lastName,c.email=a.email,c.$save(b.uid)})},authObj:e,userObj:f,signedIn:function(){return null!==e.$getAuth()}};return a.signedIn=function(){return g.signedIn()},g}]),angular.module("angularDataApp").controller("StatusCtrl",["$scope","$rootScope","Authentication","$location",function(a,b,c,d){a.logout=function(){c.logout(),d.path("/login")},c.authObj.$onAuth(function(a){if(a){var d=c.userObj(a.uid);d.$loaded().then(function(){b.currentUser=d})}else b.currentUser=null})}]),angular.module("angularDataApp").controller("CheckinsCtrl",["$scope","$routeParams","$location","$firebaseArray","$firebaseObject","FIREBASE",function(a,b,c,d,e,f){a.whichMeeting=b.meetingId,a.whichUser=b.userId;var g=f.child("/users/"+a.whichUser+"/meetings"),h=d(g);h.$loaded().then(function(b){var c=b[a.whichMeeting],e=g.child(c.$id+"/checkins"),f=d(e);f.$loaded().then(function(b){a.checkins=b})}),a.addCheckin=function(){a.checkins.$add({firstName:a.user.firstName,lastName:a.user.lastName,email:a.user.email,date:Firebase.ServerValue.TIMESTAMP}).then(function(){c.path("/checkins/"+a.whichUser+"/"+a.whichMeeting+"/checkinslist")})}}]),angular.module("angularDataApp").directive("confirmationNeeded",function(){return{priority:1,terminal:!0,link:function(a,b,c){var d=c.confirmationNeeded||"Are you sure you want to delete?",e=c.ngClick;b.bind("click",function(){window.confirm(d)&&a.$eval(e)})}}}),angular.module("angularDataApp").constant("FIREBASE",new Firebase("https://bionikspoon-attendance.firebaseio.com")),angular.module("angularDataApp").controller("CheckinsListCtrl",["$scope","$routeParams","$firebaseArray","$firebaseObject","FIREBASE",function(a,b,c,d,e){a.whichMeeting=b.meetingId,a.whichUser=b.userId,a.order="firstName",a.direction="";var f=e.child("/users/"+a.whichUser+"/meetings"),g=c(f);g.$loaded().then(function(b){var d=b[a.whichMeeting],e=f.child(d.$id+"/checkins"),g=c(e);g.$loaded().then(function(b){a.checkins=b})}),a.deleteCheckin=function(b){var c=g[a.whichMeeting],e=f.child(c.$id+"/checkins/"+b),h=d(e);h.$remove()},a.pickRandom=function(){var b=Math.floor(Math.random()*a.checkins.length);a.recordId=a.checkins.$keyAt(b)},a.showLove=function(a){a.show=!a.show,"expanded"===a.userState?a.userState="":a.userState="expanded"},a.giveLove=function(b,d){var e=g[a.whichMeeting],h=f.child(e.$id+"/checkins/"+b.$id+"/awards"),i=c(h),j={name:d,date:Firebase.ServerValue.TIMESTAMP};i.$add(j)},a.deleteLove=function(b,c){var e=g[a.whichMeeting],h=f.child(e.$id+"/checkins/"+b+"/awards/"+c),i=d(h);i.$remove()}}]);